function e(e,t,n,r){var o,s=arguments.length,i=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(i=(s<3?o(i):s>3?o(t,n,i):o(t,n))||i);return s>3&&i&&Object.defineProperty(t,n,i),i}const t="undefined"!=typeof window&&null!=window.customElements&&void 0!==window.customElements.polyfillWrapFlushCallback,n=(e,t,n=null)=>{for(;t!==n;){const n=t.nextSibling;e.removeChild(t),t=n}},r=`{{lit-${String(Math.random()).slice(2)}}}`,o=`\x3c!--${r}--\x3e`,s=new RegExp(`${r}|${o}`);class i{constructor(e,t){this.parts=[],this.element=t;const n=[],o=[],i=document.createTreeWalker(t.content,133,null,!1);let c=0,h=-1,p=0;const{strings:d,values:{length:g}}=e;for(;p<g;){const e=i.nextNode();if(null!==e){if(h++,1===e.nodeType){if(e.hasAttributes()){const t=e.attributes,{length:n}=t;let r=0;for(let e=0;e<n;e++)a(t[e].name,"$lit$")&&r++;for(;r-- >0;){const t=d[p],n=u.exec(t)[2],r=n.toLowerCase()+"$lit$",o=e.getAttribute(r);e.removeAttribute(r);const i=o.split(s);this.parts.push({type:"attribute",index:h,name:n,strings:i}),p+=i.length-1}}"TEMPLATE"===e.tagName&&(o.push(e),i.currentNode=e.content)}else if(3===e.nodeType){const t=e.data;if(t.indexOf(r)>=0){const r=e.parentNode,o=t.split(s),i=o.length-1;for(let t=0;t<i;t++){let n,s=o[t];if(""===s)n=l();else{const e=u.exec(s);null!==e&&a(e[2],"$lit$")&&(s=s.slice(0,e.index)+e[1]+e[2].slice(0,-"$lit$".length)+e[3]),n=document.createTextNode(s)}r.insertBefore(n,e),this.parts.push({type:"node",index:++h})}""===o[i]?(r.insertBefore(l(),e),n.push(e)):e.data=o[i],p+=i}}else if(8===e.nodeType)if(e.data===r){const t=e.parentNode;null!==e.previousSibling&&h!==c||(h++,t.insertBefore(l(),e)),c=h,this.parts.push({type:"node",index:h}),null===e.nextSibling?e.data="":(n.push(e),h--),p++}else{let t=-1;for(;-1!==(t=e.data.indexOf(r,t+1));)this.parts.push({type:"node",index:-1}),p++}}else i.currentNode=o.pop()}for(const e of n)e.parentNode.removeChild(e)}}const a=(e,t)=>{const n=e.length-t.length;return n>=0&&e.slice(n)===t},c=e=>-1!==e.index,l=()=>document.createComment(""),u=/([ \x09\x0a\x0c\x0d])([^\0-\x1F\x7F-\x9F "'>=/]+)([ \x09\x0a\x0c\x0d]*=[ \x09\x0a\x0c\x0d]*(?:[^ \x09\x0a\x0c\x0d"'`<>=]*|"[^"]*|'[^']*))$/;function h(e,t){const{element:{content:n},parts:r}=e,o=document.createTreeWalker(n,133,null,!1);let s=d(r),i=r[s],a=-1,c=0;const l=[];let u=null;for(;o.nextNode();){a++;const e=o.currentNode;for(e.previousSibling===u&&(u=null),t.has(e)&&(l.push(e),null===u&&(u=e)),null!==u&&c++;void 0!==i&&i.index===a;)i.index=null!==u?-1:i.index-c,s=d(r,s),i=r[s]}l.forEach((e=>e.parentNode.removeChild(e)))}const p=e=>{let t=11===e.nodeType?0:1;const n=document.createTreeWalker(e,133,null,!1);for(;n.nextNode();)t++;return t},d=(e,t=-1)=>{for(let n=t+1;n<e.length;n++){const t=e[n];if(c(t))return n}return-1};const g=new WeakMap,f=e=>(...t)=>{const n=e(...t);return g.set(n,!0),n},m=e=>"function"==typeof e&&g.has(e),y={},v={};class b{constructor(e,t,n){this.__parts=[],this.template=e,this.processor=t,this.options=n}update(e){let t=0;for(const n of this.__parts)void 0!==n&&n.setValue(e[t]),t++;for(const e of this.__parts)void 0!==e&&e.commit()}_clone(){const e=t?this.template.element.content.cloneNode(!0):document.importNode(this.template.element.content,!0),n=[],r=this.template.parts,o=document.createTreeWalker(e,133,null,!1);let s,i=0,a=0,l=o.nextNode();for(;i<r.length;)if(s=r[i],c(s)){for(;a<s.index;)a++,"TEMPLATE"===l.nodeName&&(n.push(l),o.currentNode=l.content),null===(l=o.nextNode())&&(o.currentNode=n.pop(),l=o.nextNode());if("node"===s.type){const e=this.processor.handleTextExpression(this.options);e.insertAfterNode(l.previousSibling),this.__parts.push(e)}else this.__parts.push(...this.processor.handleAttributeExpressions(l,s.name,s.strings,this.options));i++}else this.__parts.push(void 0),i++;return t&&(document.adoptNode(e),customElements.upgrade(e)),e}}const w=window.trustedTypes&&trustedTypes.createPolicy("lit-html",{createHTML:e=>e}),S=` ${r} `;class C{constructor(e,t,n,r){this.strings=e,this.values=t,this.type=n,this.processor=r}getHTML(){const e=this.strings.length-1;let t="",n=!1;for(let s=0;s<e;s++){const e=this.strings[s],i=e.lastIndexOf("\x3c!--");n=(i>-1||n)&&-1===e.indexOf("--\x3e",i+1);const a=u.exec(e);t+=null===a?e+(n?S:o):e.substr(0,a.index)+a[1]+a[2]+"$lit$"+a[3]+r}return t+=this.strings[e],t}getTemplateElement(){const e=document.createElement("template");let t=this.getHTML();return void 0!==w&&(t=w.createHTML(t)),e.innerHTML=t,e}}const k=e=>null===e||!("object"==typeof e||"function"==typeof e),_=e=>Array.isArray(e)||!(!e||!e[Symbol.iterator]);class P{constructor(e,t,n){this.dirty=!0,this.element=e,this.name=t,this.strings=n,this.parts=[];for(let e=0;e<n.length-1;e++)this.parts[e]=this._createPart()}_createPart(){return new E(this)}_getValue(){const e=this.strings,t=e.length-1,n=this.parts;if(1===t&&""===e[0]&&""===e[1]){const e=n[0].value;if("symbol"==typeof e)return String(e);if("string"==typeof e||!_(e))return e}let r="";for(let o=0;o<t;o++){r+=e[o];const t=n[o];if(void 0!==t){const e=t.value;if(k(e)||!_(e))r+="string"==typeof e?e:String(e);else for(const t of e)r+="string"==typeof t?t:String(t)}}return r+=e[t],r}commit(){this.dirty&&(this.dirty=!1,this.element.setAttribute(this.name,this._getValue()))}}class E{constructor(e){this.value=void 0,this.committer=e}setValue(e){e===y||k(e)&&e===this.value||(this.value=e,m(e)||(this.committer.dirty=!0))}commit(){for(;m(this.value);){const e=this.value;this.value=y,e(this)}this.value!==y&&this.committer.commit()}}class T{constructor(e){this.value=void 0,this.__pendingValue=void 0,this.options=e}appendInto(e){this.startNode=e.appendChild(l()),this.endNode=e.appendChild(l())}insertAfterNode(e){this.startNode=e,this.endNode=e.nextSibling}appendIntoPart(e){e.__insert(this.startNode=l()),e.__insert(this.endNode=l())}insertAfterPart(e){e.__insert(this.startNode=l()),this.endNode=e.endNode,e.endNode=this.startNode}setValue(e){this.__pendingValue=e}commit(){if(null===this.startNode.parentNode)return;for(;m(this.__pendingValue);){const e=this.__pendingValue;this.__pendingValue=y,e(this)}const e=this.__pendingValue;e!==y&&(k(e)?e!==this.value&&this.__commitText(e):e instanceof C?this.__commitTemplateResult(e):e instanceof Node?this.__commitNode(e):_(e)?this.__commitIterable(e):e===v?(this.value=v,this.clear()):this.__commitText(e))}__insert(e){this.endNode.parentNode.insertBefore(e,this.endNode)}__commitNode(e){this.value!==e&&(this.clear(),this.__insert(e),this.value=e)}__commitText(e){const t=this.startNode.nextSibling,n="string"==typeof(e=null==e?"":e)?e:String(e);t===this.endNode.previousSibling&&3===t.nodeType?t.data=n:this.__commitNode(document.createTextNode(n)),this.value=e}__commitTemplateResult(e){const t=this.options.templateFactory(e);if(this.value instanceof b&&this.value.template===t)this.value.update(e.values);else{const n=new b(t,e.processor,this.options),r=n._clone();n.update(e.values),this.__commitNode(r),this.value=n}}__commitIterable(e){Array.isArray(this.value)||(this.value=[],this.clear());const t=this.value;let n,r=0;for(const o of e)n=t[r],void 0===n&&(n=new T(this.options),t.push(n),0===r?n.appendIntoPart(this):n.insertAfterPart(t[r-1])),n.setValue(o),n.commit(),r++;r<t.length&&(t.length=r,this.clear(n&&n.endNode))}clear(e=this.startNode){n(this.startNode.parentNode,e.nextSibling,this.endNode)}}class x{constructor(e,t,n){if(this.value=void 0,this.__pendingValue=void 0,2!==n.length||""!==n[0]||""!==n[1])throw new Error("Boolean attributes can only contain a single expression");this.element=e,this.name=t,this.strings=n}setValue(e){this.__pendingValue=e}commit(){for(;m(this.__pendingValue);){const e=this.__pendingValue;this.__pendingValue=y,e(this)}if(this.__pendingValue===y)return;const e=!!this.__pendingValue;this.value!==e&&(e?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name),this.value=e),this.__pendingValue=y}}class I extends P{constructor(e,t,n){super(e,t,n),this.single=2===n.length&&""===n[0]&&""===n[1]}_createPart(){return new N(this)}_getValue(){return this.single?this.parts[0].value:super._getValue()}commit(){this.dirty&&(this.dirty=!1,this.element[this.name]=this._getValue())}}class N extends E{}let R=!1;(()=>{try{const e={get capture(){return R=!0,!1}};window.addEventListener("test",e,e),window.removeEventListener("test",e,e)}catch(e){}})();class D{constructor(e,t,n){this.value=void 0,this.__pendingValue=void 0,this.element=e,this.eventName=t,this.eventContext=n,this.__boundHandleEvent=e=>this.handleEvent(e)}setValue(e){this.__pendingValue=e}commit(){for(;m(this.__pendingValue);){const e=this.__pendingValue;this.__pendingValue=y,e(this)}if(this.__pendingValue===y)return;const e=this.__pendingValue,t=this.value,n=null==e||null!=t&&(e.capture!==t.capture||e.once!==t.once||e.passive!==t.passive),r=null!=e&&(null==t||n);n&&this.element.removeEventListener(this.eventName,this.__boundHandleEvent,this.__options),r&&(this.__options=O(e),this.element.addEventListener(this.eventName,this.__boundHandleEvent,this.__options)),this.value=e,this.__pendingValue=y}handleEvent(e){"function"==typeof this.value?this.value.call(this.eventContext||this.element,e):this.value.handleEvent(e)}}const O=e=>e&&(R?{capture:e.capture,passive:e.passive,once:e.once}:e.capture);function A(e){let t=M.get(e.type);void 0===t&&(t={stringsArray:new WeakMap,keyString:new Map},M.set(e.type,t));let n=t.stringsArray.get(e.strings);if(void 0!==n)return n;const o=e.strings.join(r);return n=t.keyString.get(o),void 0===n&&(n=new i(e,e.getTemplateElement()),t.keyString.set(o,n)),t.stringsArray.set(e.strings,n),n}const M=new Map,j=new WeakMap;const H=new class{handleAttributeExpressions(e,t,n,r){const o=t[0];if("."===o){return new I(e,t.slice(1),n).parts}if("@"===o)return[new D(e,t.slice(1),r.eventContext)];if("?"===o)return[new x(e,t.slice(1),n)];return new P(e,t,n).parts}handleTextExpression(e){return new T(e)}};"undefined"!=typeof window&&(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.3.0");const L=(e,...t)=>new C(e,t,"html",H),U=(e,t)=>`${e}--${t}`;let W=!0;void 0===window.ShadyCSS?W=!1:void 0===window.ShadyCSS.prepareTemplateDom&&(console.warn("Incompatible ShadyCSS version detected. Please update to at least @webcomponents/webcomponentsjs@2.0.2 and @webcomponents/shadycss@1.3.1."),W=!1);const q=e=>t=>{const n=U(t.type,e);let o=M.get(n);void 0===o&&(o={stringsArray:new WeakMap,keyString:new Map},M.set(n,o));let s=o.stringsArray.get(t.strings);if(void 0!==s)return s;const a=t.strings.join(r);if(s=o.keyString.get(a),void 0===s){const n=t.getTemplateElement();W&&window.ShadyCSS.prepareTemplateDom(n,e),s=new i(t,n),o.keyString.set(a,s)}return o.stringsArray.set(t.strings,s),s},V=["html","svg"],F=new Set,B=(e,t,n)=>{F.add(e);const r=n?n.element:document.createElement("template"),o=t.querySelectorAll("style"),{length:s}=o;if(0===s)return void window.ShadyCSS.prepareTemplateStyles(r,e);const i=document.createElement("style");for(let e=0;e<s;e++){const t=o[e];t.parentNode.removeChild(t),i.textContent+=t.textContent}(e=>{V.forEach((t=>{const n=M.get(U(t,e));void 0!==n&&n.keyString.forEach((e=>{const{element:{content:t}}=e,n=new Set;Array.from(t.querySelectorAll("style")).forEach((e=>{n.add(e)})),h(e,n)}))}))})(e);const a=r.content;n?function(e,t,n=null){const{element:{content:r},parts:o}=e;if(null==n)return void r.appendChild(t);const s=document.createTreeWalker(r,133,null,!1);let i=d(o),a=0,c=-1;for(;s.nextNode();)for(c++,s.currentNode===n&&(a=p(t),n.parentNode.insertBefore(t,n));-1!==i&&o[i].index===c;){if(a>0){for(;-1!==i;)o[i].index+=a,i=d(o,i);return}i=d(o,i)}}(n,i,a.firstChild):a.insertBefore(i,a.firstChild),window.ShadyCSS.prepareTemplateStyles(r,e);const c=a.querySelector("style");if(window.ShadyCSS.nativeShadow&&null!==c)t.insertBefore(c.cloneNode(!0),t.firstChild);else if(n){a.insertBefore(i,a.firstChild);const e=new Set;e.add(i),h(n,e)}};window.JSCompiler_renameProperty=(e,t)=>e;const X={toAttribute(e,t){switch(t){case Boolean:return e?"":null;case Object:case Array:return null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){switch(t){case Boolean:return null!==e;case Number:return null===e?null:Number(e);case Object:case Array:return JSON.parse(e)}return e}},$=(e,t)=>t!==e&&(t==t||e==e),z={attribute:!0,type:String,converter:X,reflect:!1,hasChanged:$};class J extends HTMLElement{constructor(){super(),this.initialize()}static get observedAttributes(){this.finalize();const e=[];return this._classProperties.forEach(((t,n)=>{const r=this._attributeNameForProperty(n,t);void 0!==r&&(this._attributeToPropertyMap.set(r,n),e.push(r))})),e}static _ensureClassProperties(){if(!this.hasOwnProperty(JSCompiler_renameProperty("_classProperties",this))){this._classProperties=new Map;const e=Object.getPrototypeOf(this)._classProperties;void 0!==e&&e.forEach(((e,t)=>this._classProperties.set(t,e)))}}static createProperty(e,t=z){if(this._ensureClassProperties(),this._classProperties.set(e,t),t.noAccessor||this.prototype.hasOwnProperty(e))return;const n="symbol"==typeof e?Symbol():"__"+e,r=this.getPropertyDescriptor(e,n,t);void 0!==r&&Object.defineProperty(this.prototype,e,r)}static getPropertyDescriptor(e,t,n){return{get(){return this[t]},set(r){const o=this[e];this[t]=r,this.requestUpdateInternal(e,o,n)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this._classProperties&&this._classProperties.get(e)||z}static finalize(){const e=Object.getPrototypeOf(this);if(e.hasOwnProperty("finalized")||e.finalize(),this.finalized=!0,this._ensureClassProperties(),this._attributeToPropertyMap=new Map,this.hasOwnProperty(JSCompiler_renameProperty("properties",this))){const e=this.properties,t=[...Object.getOwnPropertyNames(e),..."function"==typeof Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e):[]];for(const n of t)this.createProperty(n,e[n])}}static _attributeNameForProperty(e,t){const n=t.attribute;return!1===n?void 0:"string"==typeof n?n:"string"==typeof e?e.toLowerCase():void 0}static _valueHasChanged(e,t,n=$){return n(e,t)}static _propertyValueFromAttribute(e,t){const n=t.type,r=t.converter||X,o="function"==typeof r?r:r.fromAttribute;return o?o(e,n):e}static _propertyValueToAttribute(e,t){if(void 0===t.reflect)return;const n=t.type,r=t.converter;return(r&&r.toAttribute||X.toAttribute)(e,n)}initialize(){this._updateState=0,this._updatePromise=new Promise((e=>this._enableUpdatingResolver=e)),this._changedProperties=new Map,this._saveInstanceProperties(),this.requestUpdateInternal()}_saveInstanceProperties(){this.constructor._classProperties.forEach(((e,t)=>{if(this.hasOwnProperty(t)){const e=this[t];delete this[t],this._instanceProperties||(this._instanceProperties=new Map),this._instanceProperties.set(t,e)}}))}_applyInstanceProperties(){this._instanceProperties.forEach(((e,t)=>this[t]=e)),this._instanceProperties=void 0}connectedCallback(){this.enableUpdating()}enableUpdating(){void 0!==this._enableUpdatingResolver&&(this._enableUpdatingResolver(),this._enableUpdatingResolver=void 0)}disconnectedCallback(){}attributeChangedCallback(e,t,n){t!==n&&this._attributeToProperty(e,n)}_propertyToAttribute(e,t,n=z){const r=this.constructor,o=r._attributeNameForProperty(e,n);if(void 0!==o){const e=r._propertyValueToAttribute(t,n);if(void 0===e)return;this._updateState=8|this._updateState,null==e?this.removeAttribute(o):this.setAttribute(o,e),this._updateState=-9&this._updateState}}_attributeToProperty(e,t){if(8&this._updateState)return;const n=this.constructor,r=n._attributeToPropertyMap.get(e);if(void 0!==r){const e=n.getPropertyOptions(r);this._updateState=16|this._updateState,this[r]=n._propertyValueFromAttribute(t,e),this._updateState=-17&this._updateState}}requestUpdateInternal(e,t,n){let r=!0;if(void 0!==e){const o=this.constructor;n=n||o.getPropertyOptions(e),o._valueHasChanged(this[e],t,n.hasChanged)?(this._changedProperties.has(e)||this._changedProperties.set(e,t),!0!==n.reflect||16&this._updateState||(void 0===this._reflectingProperties&&(this._reflectingProperties=new Map),this._reflectingProperties.set(e,n))):r=!1}!this._hasRequestedUpdate&&r&&(this._updatePromise=this._enqueueUpdate())}requestUpdate(e,t){return this.requestUpdateInternal(e,t),this.updateComplete}async _enqueueUpdate(){this._updateState=4|this._updateState;try{await this._updatePromise}catch(e){}const e=this.performUpdate();return null!=e&&await e,!this._hasRequestedUpdate}get _hasRequestedUpdate(){return 4&this._updateState}get hasUpdated(){return 1&this._updateState}performUpdate(){if(!this._hasRequestedUpdate)return;this._instanceProperties&&this._applyInstanceProperties();let e=!1;const t=this._changedProperties;try{e=this.shouldUpdate(t),e?this.update(t):this._markUpdated()}catch(t){throw e=!1,this._markUpdated(),t}e&&(1&this._updateState||(this._updateState=1|this._updateState,this.firstUpdated(t)),this.updated(t))}_markUpdated(){this._changedProperties=new Map,this._updateState=-5&this._updateState}get updateComplete(){return this._getUpdateComplete()}_getUpdateComplete(){return this._updatePromise}shouldUpdate(e){return!0}update(e){void 0!==this._reflectingProperties&&this._reflectingProperties.size>0&&(this._reflectingProperties.forEach(((e,t)=>this._propertyToAttribute(t,this[t],e))),this._reflectingProperties=void 0),this._markUpdated()}updated(e){}firstUpdated(e){}}J.finalized=!0;const Y=(e,t)=>"method"===t.kind&&t.descriptor&&!("value"in t.descriptor)?Object.assign(Object.assign({},t),{finisher(n){n.createProperty(t.key,e)}}):{kind:"field",key:Symbol(),placement:"own",descriptor:{},initializer(){"function"==typeof t.initializer&&(this[t.key]=t.initializer.call(this))},finisher(n){n.createProperty(t.key,e)}};function Q(e){return(t,n)=>void 0!==n?((e,t,n)=>{t.constructor.createProperty(n,e)})(e,t,n):Y(e,t)}function G(e){return Q({attribute:!1,hasChanged:null==e?void 0:e.hasChanged})}const K=window.ShadowRoot&&(void 0===window.ShadyCSS||window.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,Z=Symbol();class ee{constructor(e,t){if(t!==Z)throw new Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e}get styleSheet(){return void 0===this._styleSheet&&(K?(this._styleSheet=new CSSStyleSheet,this._styleSheet.replaceSync(this.cssText)):this._styleSheet=null),this._styleSheet}toString(){return this.cssText}}const te=(e,...t)=>{const n=t.reduce(((t,n,r)=>t+(e=>{if(e instanceof ee)return e.cssText;if("number"==typeof e)return e;throw new Error(`Value passed to 'css' function must be a 'css' function result: ${e}. Use 'unsafeCSS' to pass non-literal values, but\n            take care to ensure page security.`)})(n)+e[r+1]),e[0]);return new ee(n,Z)};(window.litElementVersions||(window.litElementVersions=[])).push("2.4.0");const ne={};class re extends J{static getStyles(){return this.styles}static _getUniqueStyles(){if(this.hasOwnProperty(JSCompiler_renameProperty("_styles",this)))return;const e=this.getStyles();if(Array.isArray(e)){const t=(e,n)=>e.reduceRight(((e,n)=>Array.isArray(n)?t(n,e):(e.add(n),e)),n),n=t(e,new Set),r=[];n.forEach((e=>r.unshift(e))),this._styles=r}else this._styles=void 0===e?[]:[e];this._styles=this._styles.map((e=>{if(e instanceof CSSStyleSheet&&!K){const t=Array.prototype.slice.call(e.cssRules).reduce(((e,t)=>e+t.cssText),"");return new ee(String(t),Z)}return e}))}initialize(){super.initialize(),this.constructor._getUniqueStyles(),this.renderRoot=this.createRenderRoot(),window.ShadowRoot&&this.renderRoot instanceof window.ShadowRoot&&this.adoptStyles()}createRenderRoot(){return this.attachShadow({mode:"open"})}adoptStyles(){const e=this.constructor._styles;0!==e.length&&(void 0===window.ShadyCSS||window.ShadyCSS.nativeShadow?K?this.renderRoot.adoptedStyleSheets=e.map((e=>e instanceof CSSStyleSheet?e:e.styleSheet)):this._needsShimAdoptedStyleSheets=!0:window.ShadyCSS.ScopingShim.prepareAdoptedCssText(e.map((e=>e.cssText)),this.localName))}connectedCallback(){super.connectedCallback(),this.hasUpdated&&void 0!==window.ShadyCSS&&window.ShadyCSS.styleElement(this)}update(e){const t=this.render();super.update(e),t!==ne&&this.constructor.render(t,this.renderRoot,{scopeName:this.localName,eventContext:this}),this._needsShimAdoptedStyleSheets&&(this._needsShimAdoptedStyleSheets=!1,this.constructor._styles.forEach((e=>{const t=document.createElement("style");t.textContent=e.cssText,this.renderRoot.appendChild(t)})))}render(){return ne}}re.finalized=!0,re.render=(e,t,r)=>{if(!r||"object"!=typeof r||!r.scopeName)throw new Error("The `scopeName` option is required.");const o=r.scopeName,s=j.has(t),i=W&&11===t.nodeType&&!!t.host,a=i&&!F.has(o),c=a?document.createDocumentFragment():t;if(((e,t,r)=>{let o=j.get(t);void 0===o&&(n(t,t.firstChild),j.set(t,o=new T(Object.assign({templateFactory:A},r))),o.appendInto(t)),o.setValue(e),o.commit()})(e,c,Object.assign({templateFactory:q(o)},r)),a){const e=j.get(c);j.delete(c);const r=e.value instanceof b?e.value.template:void 0;B(o,c,r),n(t,t.firstChild),t.appendChild(c),j.set(t,e)}!s&&i&&window.ShadyCSS.styleElement(t.host)};const oe=new WeakMap,se=f((e=>t=>{if(!(t instanceof T))throw new Error("unsafeHTML can only be used in text bindings");const n=oe.get(t);if(void 0!==n&&k(e)&&e===n.value&&t.value===n.fragment)return;const r=document.createElement("template");r.innerHTML=e;const o=document.importNode(r.content,!0);t.setValue(o),oe.set(t,{value:e,fragment:o})}));let ie,ae,ce=e=>e;class le extends re{constructor(){super(...arguments),this.message=void 0,this.timeout=5e3,this.expiring=!1,this.getMainMessageClass=()=>{var e,t,n,r,o,s,i,a;let c="event";return this.expiring&&(c+=" hideme"),(null===(t=null===(e=this.message)||void 0===e?void 0:e.userTypeList)||void 0===t?void 0:t.includes("vip"))&&(c+=" event-vip"),(null===(r=null===(n=this.message)||void 0===n?void 0:n.userTypeList)||void 0===r?void 0:r.includes("moderator"))&&(c+=" event-mod"),(null===(s=null===(o=this.message)||void 0===o?void 0:o.userTypeList)||void 0===s?void 0:s.includes("broadcaster"))&&(c+=" event-broadcaster"),(null===(a=null===(i=this.message)||void 0===i?void 0:i.userTypeList)||void 0===a?void 0:a.includes("subscriber"))&&(c+=" event-subscriber"),c},this.getDisplayNameClass=()=>{var e,t,n,r,o,s,i,a;let c="displayName";return(null===(t=null===(e=this.message)||void 0===e?void 0:e.userTypeList)||void 0===t?void 0:t.includes("vip"))&&(c+=" displayName-vip"),(null===(r=null===(n=this.message)||void 0===n?void 0:n.userTypeList)||void 0===r?void 0:r.includes("moderator"))&&(c+=" displayName-mod"),(null===(s=null===(o=this.message)||void 0===o?void 0:o.userTypeList)||void 0===s?void 0:s.includes("broadcaster"))&&(c+=" displayName-broadcaster"),(null===(a=null===(i=this.message)||void 0===i?void 0:i.userTypeList)||void 0===a?void 0:a.includes("subscriber"))&&(c+=" displayName-subscriber"),c},this.getMessageClass=()=>{let e="message";return this.processedChat.message.startsWith('<span class="tag">')&&(e+=" message-startsWithTag"),e}}connectedCallback(){super.connectedCallback(),setTimeout((()=>{console.log("Message is expiring"),this.message&&(this.expiring=!0),this.requestUpdate(),setTimeout((()=>{this.message&&(this.message.expired=!0),this.requestUpdate(),console.log("Message expired...")}),2e3)}),this.timeout),console.log(`Added with a timeout of: [${this.timeout}]ms`)}processChat(e){let t=(null==e?void 0:e.message.replace(/<img/g,"<DEL"))||"";const n=[];if(null==e?void 0:e.emotes){let r=[];for(const t of Object.keys(e.emotes)){e.emotes[t].forEach((e=>{r.push(this.generateEmote(t,e))}))}r.sort(((e,t)=>t.end-e.end)),r.forEach((e=>{n.push(e.emoteUrl);let r=t.slice(0,e.start);r+=e.emoteImageTag,r+=t.slice(e.end+1,t.length),t=r}))}return t=t.replace(/@(\w*)/gm,'<span class="tag">$&</span>'),{message:t,emotes:n.map((e=>e.emoteImageTag))}}generateEmote(e,t){const[n,r]=t.split("-").map(Number);return{emoteId:e,emoteImageTag:`<img class='emote' src='https://static-cdn.jtvnw.net/emoticons/v1/${e}/1.0'/>`,emoteUrl:`https://static-cdn.jtvnw.net/emoticons/v1/${e}/1.0`,start:n,end:r}}get processedChat(){return this.processChat(this.message)}render(){var e,t;return L(ie||(ie=ce` <div class="${0}"> <div class="avatarContainer" style="background-image:url(${0})"></div> <div class="messageContainer"> <p class="${0}"> @${0} </p> <div class="${0}"> ${0} </div> </div> </div> `),this.getMainMessageClass(),null===(e=this.message)||void 0===e?void 0:e.logoUrl,this.getDisplayNameClass(),null===(t=this.message)||void 0===t?void 0:t.displayName,this.getMessageClass(),se(this.processedChat.message))}}le.styles=te(ae||(ae=ce`:host{--top-border-size:6px}h1,h2,h3,h4,h5,h6,p{margin:0;font-weight:var(--font-weight-normal)}@keyframes slideIn{0%{transform:translateX(-400px);opacity:0}100%{transform:translateX(0);opacity:1}}.event{animation:slideIn .2s ease-in-out;background-color:var(--black);display:flex;flex-direction:row;margin-top:.5rem;margin-bottom:.5rem;border-top:var(--top-border-size) solid;border-image-slice:1;border-image-source:linear-gradient(90deg,var(--yellow) 0,var(--yellow) 100%);box-shadow:0 .6rem 1rem -.4rem var(--black);border-bottom-right-radius:.25rem;position:relative;overflow:hidden}.event-subscriber:after{content:'';position:absolute;right:-4px;bottom:-13px;transform:rotate(45deg);border-top:20px solid transparent;border-bottom:20px solid transparent;border-left:20px solid var(--yellow)}.event-broadcaster:after{content:'';position:absolute;right:-4px;bottom:-13px;transform:rotate(45deg);border-top:20px solid transparent;border-bottom:20px solid transparent;border-left:20px solid transparent;border-image-source:linear-gradient(90deg,var(--vip) 0,var(--blue-darker) 100%)}.event-vip{border-image-source:linear-gradient(90deg,var(--yellow) 0,var(--vip) 100%)}.event-mod{border-image-source:linear-gradient(90deg,var(--yellow) 0,var(--mod) 100%)}.event-broadcaster{border-image-source:linear-gradient(90deg,var(--yellow) 0,var(--broadcaster) 100%)}.displayName{color:var(--white);font-size:1rem;margin-bottom:1rem;color:var(--yellow);font-weight:var(--font-weight-bold)}.displayName-vip{background:linear-gradient(90deg,var(--yellow),var(--vip));background-clip:text;-webkit-background-clip:text;-webkit-text-fill-color:transparent}.displayName-mod{background:linear-gradient(90deg,var(--yellow),var(--mod));background-clip:text;-webkit-background-clip:text;-webkit-text-fill-color:transparent}.displayName-broadcaster{background:linear-gradient(90deg,var(--yellow),var(--broadcaster));background-clip:text;-webkit-background-clip:text;-webkit-text-fill-color:transparent}.message{color:var(--white);font-size:1.4rem;display:inline-block;word-break:break-word;line-height:1.6rem;font-weight:var(--font-weight-normal)}.message-startsWithTag .tag:first-of-type{padding-left:0}.avatarContainer{background-repeat:no-repeat;background-position:center center;background-size:cover;flex:0 0 100px;background-position-y:50%;background-color:var(--black)}.messageContainer{padding:1rem;width:100%}.tag{color:var(--yellow);padding-left:4px;padding-right:4px}.emote{display:inline-block;position:relative;top:2px;margin-left:-4px;margin-right:-4px}@-webkit-keyframes slide-rotate-ver-left{0%{-webkit-transform:translateX(0) rotateY(0);transform:translateX(0) rotateY(0)}100%{-webkit-transform:translateX(-150px) rotateY(90deg);transform:translateX(-150px) rotateY(90deg)}}@keyframes slide-rotate-ver-left{0%{-webkit-transform:translateX(0) rotateY(0);transform:translateX(0) rotateY(0)}100%{-webkit-transform:translateX(-150px) rotateY(90deg);transform:translateX(-150px) rotateY(90deg)}}@-webkit-keyframes swing-out-bottom-bck{0%{-webkit-transform:rotateX(0);transform:rotateX(0);-webkit-transform-origin:bottom;transform-origin:bottom;opacity:1}100%{-webkit-transform:rotateX(100deg);transform:rotateX(100deg);-webkit-transform-origin:bottom;transform-origin:bottom;opacity:0}}@keyframes swing-out-bottom-bck{0%{-webkit-transform:rotateX(0);transform:rotateX(0);-webkit-transform-origin:bottom;transform-origin:bottom;opacity:1}100%{-webkit-transform:rotateX(100deg);transform:rotateX(100deg);-webkit-transform-origin:bottom;transform-origin:bottom;opacity:0}}@-webkit-keyframes swing-out-left-bck{0%{-webkit-transform:rotateY(0);transform:rotateY(0);-webkit-transform-origin:left;transform-origin:left;opacity:1}100%{-webkit-transform:rotateY(100deg);transform:rotateY(100deg);-webkit-transform-origin:left;transform-origin:left;opacity:0}}@keyframes swing-out-left-bck{0%{-webkit-transform:rotateY(0);transform:rotateY(0);-webkit-transform-origin:left;transform-origin:left;opacity:1}100%{-webkit-transform:rotateY(100deg);transform:rotateY(100deg);-webkit-transform-origin:left;transform-origin:left;opacity:0}}@-webkit-keyframes rotate-out-hor{0%{-webkit-transform:rotateX(360deg);transform:rotateX(360deg);opacity:1}100%{-webkit-transform:rotateX(0);transform:rotateX(0);opacity:0}}@keyframes rotate-out-hor{0%{-webkit-transform:rotateX(360deg);transform:rotateX(360deg);opacity:1}100%{-webkit-transform:rotateX(0);transform:rotateX(0);opacity:0}}.hideme{-webkit-animation:swing-out-left-bck 1.45s cubic-bezier(.6,-.28,.735,.045) both;animation:swing-out-left-bck 1.45s cubic-bezier(.6,-.28,.735,.045) both}`)),e([Q()],le.prototype,"message",void 0),e([Q({type:Number})],le.prototype,"timeout",void 0),e([G()],le.prototype,"expiring",void 0),e([G()],le.prototype,"processedChat",null);const ue=(e,t)=>{const n=e.startNode.parentNode,r=void 0===t?e.endNode:t.startNode,o=n.insertBefore(l(),r);n.insertBefore(l(),r);const s=new T(e.options);return s.insertAfterNode(o),s},he=(e,t)=>(e.setValue(t),e.commit(),e),pe=(e,t,n)=>{const r=e.startNode.parentNode,o=n?n.startNode:e.endNode,s=t.endNode.nextSibling;s!==o&&((e,t,n=null,r=null)=>{for(;t!==n;){const n=t.nextSibling;e.insertBefore(t,r),t=n}})(r,t.startNode,s,o)},de=e=>{n(e.startNode.parentNode,e.startNode,e.endNode.nextSibling)},ge=(e,t,n)=>{const r=new Map;for(let o=t;o<=n;o++)r.set(e[o],o);return r},fe=new WeakMap,me=new WeakMap,ye=f(((e,t,n)=>{let r;return void 0===n?n=t:void 0!==t&&(r=t),t=>{if(!(t instanceof T))throw new Error("repeat can only be used in text bindings");const o=fe.get(t)||[],s=me.get(t)||[],i=[],a=[],c=[];let l,u,h=0;for(const t of e)c[h]=r?r(t,h):h,a[h]=n(t,h),h++;let p=0,d=o.length-1,g=0,f=a.length-1;for(;p<=d&&g<=f;)if(null===o[p])p++;else if(null===o[d])d--;else if(s[p]===c[g])i[g]=he(o[p],a[g]),p++,g++;else if(s[d]===c[f])i[f]=he(o[d],a[f]),d--,f--;else if(s[p]===c[f])i[f]=he(o[p],a[f]),pe(t,o[p],i[f+1]),p++,f--;else if(s[d]===c[g])i[g]=he(o[d],a[g]),pe(t,o[d],o[p]),d--,g++;else if(void 0===l&&(l=ge(c,g,f),u=ge(s,p,d)),l.has(s[p]))if(l.has(s[d])){const e=u.get(c[g]),n=void 0!==e?o[e]:null;if(null===n){const e=ue(t,o[p]);he(e,a[g]),i[g]=e}else i[g]=he(n,a[g]),pe(t,n,o[p]),o[e]=null;g++}else de(o[d]),d--;else de(o[p]),p++;for(;g<=f;){const e=ue(t,i[f+1]);he(e,a[g]),i[g++]=e}for(;p<=d;){const e=o[p++];null!==e&&de(e)}fe.set(t,i),me.set(t,c)}}));var ve,be,we=(ve=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}ve(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),Se=function(e){function t(t,n){var r=this,o=this.constructor.prototype;return(r=e.call(this,t)||this).statusCode=n,r.__proto__=o,r}return we(t,e),t}(Error),Ce=function(e){function t(t){void 0===t&&(t="A timeout occurred.");var n=this,r=this.constructor.prototype;return(n=e.call(this,t)||this).__proto__=r,n}return we(t,e),t}(Error),ke=function(e){function t(t){void 0===t&&(t="An abort occurred.");var n=this,r=this.constructor.prototype;return(n=e.call(this,t)||this).__proto__=r,n}return we(t,e),t}(Error),_e=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Pe=function(e,t,n){this.statusCode=e,this.statusText=t,this.content=n},Ee=function(){function e(){}return e.prototype.get=function(e,t){return this.send(_e({},t,{method:"GET",url:e}))},e.prototype.post=function(e,t){return this.send(_e({},t,{method:"POST",url:e}))},e.prototype.delete=function(e,t){return this.send(_e({},t,{method:"DELETE",url:e}))},e.prototype.getCookieString=function(e){return""},e}();!function(e){e[e.Trace=0]="Trace",e[e.Debug=1]="Debug",e[e.Information=2]="Information",e[e.Warning=3]="Warning",e[e.Error=4]="Error",e[e.Critical=5]="Critical",e[e.None=6]="None"}(be||(be={}));var Te=function(){function e(){}return e.prototype.log=function(e,t){},e.instance=new e,e}(),xe=function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(i,a)}c((r=r.apply(e,t||[])).next())}))},Ie=function(e,t){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},Ne=function(){function e(){}return e.isRequired=function(e,t){if(null==e)throw new Error("The '"+t+"' argument is required.")},e.isIn=function(e,t,n){if(!(e in t))throw new Error("Unknown "+n+" value: "+e+".")},e}(),Re=function(){function e(){}return Object.defineProperty(e,"isBrowser",{get:function(){return"object"==typeof window},enumerable:!0,configurable:!0}),Object.defineProperty(e,"isWebWorker",{get:function(){return"object"==typeof self&&"importScripts"in self},enumerable:!0,configurable:!0}),Object.defineProperty(e,"isNode",{get:function(){return!this.isBrowser&&!this.isWebWorker},enumerable:!0,configurable:!0}),e}();function De(e,t){var n="";return Oe(e)?(n="Binary data of length "+e.byteLength,t&&(n+=". Content: '"+function(e){var t=new Uint8Array(e),n="";return t.forEach((function(e){n+="0x"+(e<16?"0":"")+e.toString(16)+" "})),n.substr(0,n.length-1)}(e)+"'")):"string"==typeof e&&(n="String data of length "+e.length,t&&(n+=". Content: '"+e+"'")),n}function Oe(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function Ae(e,t,n,r,o,s,i){return xe(this,void 0,void 0,(function(){var a,c,l,u,h;return Ie(this,(function(p){switch(p.label){case 0:return o?[4,o()]:[3,2];case 1:(l=p.sent())&&((a={}).Authorization="Bearer "+l,c=a),p.label=2;case 2:return e.log(be.Trace,"("+t+" transport) sending data. "+De(s,i)+"."),u=Oe(s)?"arraybuffer":"text",[4,n.post(r,{content:s,headers:c,responseType:u})];case 3:return h=p.sent(),e.log(be.Trace,"("+t+" transport) request complete. Response status: "+h.statusCode+"."),[2]}}))}))}var Me,je=function(){function e(e,t){this.subject=e,this.observer=t}return e.prototype.dispose=function(){var e=this.subject.observers.indexOf(this.observer);e>-1&&this.subject.observers.splice(e,1),0===this.subject.observers.length&&this.subject.cancelCallback&&this.subject.cancelCallback().catch((function(e){}))},e}(),He=function(){function e(e){this.minimumLogLevel=e,this.outputConsole=console}return e.prototype.log=function(e,t){if(e>=this.minimumLogLevel)switch(e){case be.Critical:case be.Error:this.outputConsole.error("["+(new Date).toISOString()+"] "+be[e]+": "+t);break;case be.Warning:this.outputConsole.warn("["+(new Date).toISOString()+"] "+be[e]+": "+t);break;case be.Information:this.outputConsole.info("["+(new Date).toISOString()+"] "+be[e]+": "+t);break;default:this.outputConsole.log("["+(new Date).toISOString()+"] "+be[e]+": "+t)}},e}(),Le=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ue=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e};if("undefined"==typeof XMLHttpRequest){var We="function"==typeof __webpack_require__?__non_webpack_require__:require;Me=We("request")}var qe,Ve=function(e){function t(t){var n=e.call(this)||this;if(void 0===Me)throw new Error("The 'request' module could not be loaded.");return n.logger=t,n.cookieJar=Me.jar(),n.request=Me.defaults({jar:n.cookieJar}),n}return Le(t,e),t.prototype.send=function(e){var t=this;return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new ke):new Promise((function(n,r){var o;o=Oe(e.content)?Buffer.from(e.content):e.content||"";var s=t.request(e.url,{body:o,encoding:"arraybuffer"===e.responseType?null:"utf8",headers:Ue({"X-Requested-With":"XMLHttpRequest"},e.headers),method:e.method,timeout:e.timeout},(function(o,s,i){if(e.abortSignal&&(e.abortSignal.onabort=null),o)return"ETIMEDOUT"===o.code&&(t.logger.log(be.Warning,"Timeout from HTTP request."),r(new Ce)),t.logger.log(be.Warning,"Error from HTTP request. "+o),void r(o);s.statusCode>=200&&s.statusCode<300?n(new Pe(s.statusCode,s.statusMessage||"",i)):r(new Se(s.statusMessage||"",s.statusCode||0))}));e.abortSignal&&(e.abortSignal.onabort=function(){s.abort(),r(new ke)})}))},t.prototype.getCookieString=function(e){return this.cookieJar.getCookieString(e)},t}(Ee),Fe=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Be=function(e){function t(t){var n=e.call(this)||this;return n.logger=t,n}return Fe(t,e),t.prototype.send=function(e){var t=this;return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new ke):e.method?e.url?new Promise((function(n,r){var o=new XMLHttpRequest;o.open(e.method,e.url,!0),o.withCredentials=!0,o.setRequestHeader("X-Requested-With","XMLHttpRequest"),o.setRequestHeader("Content-Type","text/plain;charset=UTF-8");var s=e.headers;s&&Object.keys(s).forEach((function(e){o.setRequestHeader(e,s[e])})),e.responseType&&(o.responseType=e.responseType),e.abortSignal&&(e.abortSignal.onabort=function(){o.abort(),r(new ke)}),e.timeout&&(o.timeout=e.timeout),o.onload=function(){e.abortSignal&&(e.abortSignal.onabort=null),o.status>=200&&o.status<300?n(new Pe(o.status,o.statusText,o.response||o.responseText)):r(new Se(o.statusText,o.status))},o.onerror=function(){t.logger.log(be.Warning,"Error from HTTP request. "+o.status+": "+o.statusText+"."),r(new Se(o.statusText,o.status))},o.ontimeout=function(){t.logger.log(be.Warning,"Timeout from HTTP request."),r(new Ce)},o.send(e.content||"")})):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))},t}(Ee),Xe=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),$e=function(e){function t(t){var n=e.call(this)||this;return"undefined"!=typeof XMLHttpRequest?n.httpClient=new Be(t):n.httpClient=new Ve(t),n}return Xe(t,e),t.prototype.send=function(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new ke):e.method?e.url?this.httpClient.send(e):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))},t.prototype.getCookieString=function(e){return this.httpClient.getCookieString(e)},t}(Ee),ze=function(){function e(){}return e.write=function(t){return""+t+e.RecordSeparator},e.parse=function(t){if(t[t.length-1]!==e.RecordSeparator)throw new Error("Message is incomplete.");var n=t.split(e.RecordSeparator);return n.pop(),n},e.RecordSeparatorCode=30,e.RecordSeparator=String.fromCharCode(e.RecordSeparatorCode),e}(),Je=function(){function e(){}return e.prototype.writeHandshakeRequest=function(e){return ze.write(JSON.stringify(e))},e.prototype.parseHandshakeResponse=function(e){var t,n;if(Oe(e)||"undefined"!=typeof Buffer&&e instanceof Buffer){var r=new Uint8Array(e);if(-1===(s=r.indexOf(ze.RecordSeparatorCode)))throw new Error("Message is incomplete.");var o=s+1;t=String.fromCharCode.apply(null,r.slice(0,o)),n=r.byteLength>o?r.slice(o).buffer:null}else{var s,i=e;if(-1===(s=i.indexOf(ze.RecordSeparator)))throw new Error("Message is incomplete.");o=s+1;t=i.substring(0,o),n=i.length>o?i.substring(o):null}var a=ze.parse(t),c=JSON.parse(a[0]);if(c.type)throw new Error("Expected a handshake response from the server.");return[n,c]},e}();!function(e){e[e.Invocation=1]="Invocation",e[e.StreamItem=2]="StreamItem",e[e.Completion=3]="Completion",e[e.StreamInvocation=4]="StreamInvocation",e[e.CancelInvocation=5]="CancelInvocation",e[e.Ping=6]="Ping",e[e.Close=7]="Close"}(qe||(qe={}));var Ye,Qe=function(){function e(){this.observers=[]}return e.prototype.next=function(e){for(var t=0,n=this.observers;t<n.length;t++){n[t].next(e)}},e.prototype.error=function(e){for(var t=0,n=this.observers;t<n.length;t++){var r=n[t];r.error&&r.error(e)}},e.prototype.complete=function(){for(var e=0,t=this.observers;e<t.length;e++){var n=t[e];n.complete&&n.complete()}},e.prototype.subscribe=function(e){return this.observers.push(e),new je(this,e)},e}(),Ge=function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(i,a)}c((r=r.apply(e,t||[])).next())}))},Ke=function(e,t){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};!function(e){e.Disconnected="Disconnected",e.Connecting="Connecting",e.Connected="Connected",e.Disconnecting="Disconnecting",e.Reconnecting="Reconnecting"}(Ye||(Ye={}));var Ze,et,tt=function(){function e(e,t,n,r){var o=this;Ne.isRequired(e,"connection"),Ne.isRequired(t,"logger"),Ne.isRequired(n,"protocol"),this.serverTimeoutInMilliseconds=3e4,this.keepAliveIntervalInMilliseconds=15e3,this.logger=t,this.protocol=n,this.connection=e,this.reconnectPolicy=r,this.handshakeProtocol=new Je,this.connection.onreceive=function(e){return o.processIncomingData(e)},this.connection.onclose=function(e){return o.connectionClosed(e)},this.callbacks={},this.methods={},this.closedCallbacks=[],this.reconnectingCallbacks=[],this.reconnectedCallbacks=[],this.invocationId=0,this.receivedHandshakeResponse=!1,this.connectionState=Ye.Disconnected,this.connectionStarted=!1,this.cachedPingMessage=this.protocol.writeMessage({type:qe.Ping})}return e.create=function(t,n,r,o){return new e(t,n,r,o)},Object.defineProperty(e.prototype,"state",{get:function(){return this.connectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"connectionId",{get:function(){return this.connection&&this.connection.connectionId||null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"baseUrl",{get:function(){return this.connection.baseUrl||""},set:function(e){if(this.connectionState!==Ye.Disconnected&&this.connectionState!==Ye.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!e)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=e},enumerable:!0,configurable:!0}),e.prototype.start=function(){return this.startPromise=this.startWithStateTransitions(),this.startPromise},e.prototype.startWithStateTransitions=function(){return Ge(this,void 0,void 0,(function(){var e;return Ke(this,(function(t){switch(t.label){case 0:if(this.connectionState!==Ye.Disconnected)return[2,Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."))];this.connectionState=Ye.Connecting,this.logger.log(be.Debug,"Starting HubConnection."),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.startInternal()];case 2:return t.sent(),this.connectionState=Ye.Connected,this.connectionStarted=!0,this.logger.log(be.Debug,"HubConnection connected successfully."),[3,4];case 3:return e=t.sent(),this.connectionState=Ye.Disconnected,this.logger.log(be.Debug,"HubConnection failed to start successfully because of error '"+e+"'."),[2,Promise.reject(e)];case 4:return[2]}}))}))},e.prototype.startInternal=function(){return Ge(this,void 0,void 0,(function(){var e,t,n,r=this;return Ke(this,(function(o){switch(o.label){case 0:return this.stopDuringStartError=void 0,this.receivedHandshakeResponse=!1,e=new Promise((function(e,t){r.handshakeResolver=e,r.handshakeRejecter=t})),[4,this.connection.start(this.protocol.transferFormat)];case 1:o.sent(),o.label=2;case 2:return o.trys.push([2,5,,7]),t={protocol:this.protocol.name,version:this.protocol.version},this.logger.log(be.Debug,"Sending handshake request."),[4,this.sendMessage(this.handshakeProtocol.writeHandshakeRequest(t))];case 3:return o.sent(),this.logger.log(be.Information,"Using HubProtocol '"+this.protocol.name+"'."),this.cleanupTimeout(),this.resetTimeoutPeriod(),this.resetKeepAliveInterval(),[4,e];case 4:if(o.sent(),this.stopDuringStartError)throw this.stopDuringStartError;return[3,7];case 5:return n=o.sent(),this.logger.log(be.Debug,"Hub handshake failed with error '"+n+"' during start(). Stopping HubConnection."),this.cleanupTimeout(),this.cleanupPingTimer(),[4,this.connection.stop(n)];case 6:throw o.sent(),n;case 7:return[2]}}))}))},e.prototype.stop=function(){return Ge(this,void 0,void 0,(function(){var e;return Ke(this,(function(t){switch(t.label){case 0:return e=this.startPromise,this.stopPromise=this.stopInternal(),[4,this.stopPromise];case 1:t.sent(),t.label=2;case 2:return t.trys.push([2,4,,5]),[4,e];case 3:return t.sent(),[3,5];case 4:return t.sent(),[3,5];case 5:return[2]}}))}))},e.prototype.stopInternal=function(e){return this.connectionState===Ye.Disconnected?(this.logger.log(be.Debug,"Call to HubConnection.stop("+e+") ignored because it is already in the disconnected state."),Promise.resolve()):this.connectionState===Ye.Disconnecting?(this.logger.log(be.Debug,"Call to HttpConnection.stop("+e+") ignored because the connection is already in the disconnecting state."),this.stopPromise):(this.connectionState=Ye.Disconnecting,this.logger.log(be.Debug,"Stopping HubConnection."),this.reconnectDelayHandle?(this.logger.log(be.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this.reconnectDelayHandle),this.reconnectDelayHandle=void 0,this.completeClose(),Promise.resolve()):(this.cleanupTimeout(),this.cleanupPingTimer(),this.stopDuringStartError=e||new Error("The connection was stopped before the hub handshake could complete."),this.connection.stop(e)))},e.prototype.stream=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var o,s=this.replaceStreamingParams(n),i=s[0],a=s[1],c=this.createStreamInvocation(e,n,a),l=new Qe;return l.cancelCallback=function(){var e=t.createCancelInvocation(c.invocationId);return delete t.callbacks[c.invocationId],o.then((function(){return t.sendWithProtocol(e)}))},this.callbacks[c.invocationId]=function(e,t){t?l.error(t):e&&(e.type===qe.Completion?e.error?l.error(new Error(e.error)):l.complete():l.next(e.item))},o=this.sendWithProtocol(c).catch((function(e){l.error(e),delete t.callbacks[c.invocationId]})),this.launchStreams(i,o),l},e.prototype.sendMessage=function(e){return this.resetKeepAliveInterval(),this.connection.send(e)},e.prototype.sendWithProtocol=function(e){return this.sendMessage(this.protocol.writeMessage(e))},e.prototype.send=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=this.replaceStreamingParams(t),o=r[0],s=r[1],i=this.sendWithProtocol(this.createInvocation(e,t,!0,s));return this.launchStreams(o,i),i},e.prototype.invoke=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var o=this.replaceStreamingParams(n),s=o[0],i=o[1],a=this.createInvocation(e,n,!1,i),c=new Promise((function(e,n){t.callbacks[a.invocationId]=function(t,r){r?n(r):t&&(t.type===qe.Completion?t.error?n(new Error(t.error)):e(t.result):n(new Error("Unexpected message type: "+t.type)))};var r=t.sendWithProtocol(a).catch((function(e){n(e),delete t.callbacks[a.invocationId]}));t.launchStreams(s,r)}));return c},e.prototype.on=function(e,t){e&&t&&(e=e.toLowerCase(),this.methods[e]||(this.methods[e]=[]),-1===this.methods[e].indexOf(t)&&this.methods[e].push(t))},e.prototype.off=function(e,t){if(e){e=e.toLowerCase();var n=this.methods[e];if(n)if(t){var r=n.indexOf(t);-1!==r&&(n.splice(r,1),0===n.length&&delete this.methods[e])}else delete this.methods[e]}},e.prototype.onclose=function(e){e&&this.closedCallbacks.push(e)},e.prototype.onreconnecting=function(e){e&&this.reconnectingCallbacks.push(e)},e.prototype.onreconnected=function(e){e&&this.reconnectedCallbacks.push(e)},e.prototype.processIncomingData=function(e){if(this.cleanupTimeout(),this.receivedHandshakeResponse||(e=this.processHandshakeResponse(e),this.receivedHandshakeResponse=!0),e)for(var t=0,n=this.protocol.parseMessages(e,this.logger);t<n.length;t++){var r=n[t];switch(r.type){case qe.Invocation:this.invokeClientMethod(r);break;case qe.StreamItem:case qe.Completion:var o=this.callbacks[r.invocationId];o&&(r.type===qe.Completion&&delete this.callbacks[r.invocationId],o(r));break;case qe.Ping:break;case qe.Close:this.logger.log(be.Information,"Close message received from server.");var s=r.error?new Error("Server returned an error on close: "+r.error):void 0;!0===r.allowReconnect?this.connection.stop(s):this.stopPromise=this.stopInternal(s);break;default:this.logger.log(be.Warning,"Invalid message type: "+r.type+".")}}this.resetTimeoutPeriod()},e.prototype.processHandshakeResponse=function(e){var t,n,r;try{r=(t=this.handshakeProtocol.parseHandshakeResponse(e))[0],n=t[1]}catch(e){var o="Error parsing handshake response: "+e;this.logger.log(be.Error,o);var s=new Error(o);throw this.handshakeRejecter(s),s}if(n.error){o="Server returned handshake error: "+n.error;this.logger.log(be.Error,o);s=new Error(o);throw this.handshakeRejecter(s),s}return this.logger.log(be.Debug,"Server handshake complete."),this.handshakeResolver(),r},e.prototype.resetKeepAliveInterval=function(){var e=this;this.cleanupPingTimer(),this.pingServerHandle=setTimeout((function(){return Ge(e,void 0,void 0,(function(){return Ke(this,(function(e){switch(e.label){case 0:if(this.connectionState!==Ye.Connected)return[3,4];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.sendMessage(this.cachedPingMessage)];case 2:return e.sent(),[3,4];case 3:return e.sent(),this.cleanupPingTimer(),[3,4];case 4:return[2]}}))}))}),this.keepAliveIntervalInMilliseconds)},e.prototype.resetTimeoutPeriod=function(){var e=this;this.connection.features&&this.connection.features.inherentKeepAlive||(this.timeoutHandle=setTimeout((function(){return e.serverTimeout()}),this.serverTimeoutInMilliseconds))},e.prototype.serverTimeout=function(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))},e.prototype.invokeClientMethod=function(e){var t=this,n=this.methods[e.target.toLowerCase()];if(n){try{n.forEach((function(n){return n.apply(t,e.arguments)}))}catch(t){this.logger.log(be.Error,"A callback for the method "+e.target.toLowerCase()+" threw error '"+t+"'.")}if(e.invocationId){var r="Server requested a response, which is not supported in this version of the client.";this.logger.log(be.Error,r),this.stopPromise=this.stopInternal(new Error(r))}}else this.logger.log(be.Warning,"No client method with the name '"+e.target+"' found.")},e.prototype.connectionClosed=function(e){this.logger.log(be.Debug,"HubConnection.connectionClosed("+e+") called while in state "+this.connectionState+"."),this.stopDuringStartError=this.stopDuringStartError||e||new Error("The underlying connection was closed before the hub handshake could complete."),this.handshakeResolver&&this.handshakeResolver(),this.cancelCallbacksWithError(e||new Error("Invocation canceled due to the underlying connection being closed.")),this.cleanupTimeout(),this.cleanupPingTimer(),this.connectionState===Ye.Disconnecting?this.completeClose(e):this.connectionState===Ye.Connected&&this.reconnectPolicy?this.reconnect(e):this.connectionState===Ye.Connected&&this.completeClose(e)},e.prototype.completeClose=function(e){var t=this;if(this.connectionStarted){this.connectionState=Ye.Disconnected,this.connectionStarted=!1;try{this.closedCallbacks.forEach((function(n){return n.apply(t,[e])}))}catch(t){this.logger.log(be.Error,"An onclose callback called with error '"+e+"' threw error '"+t+"'.")}}},e.prototype.reconnect=function(e){return Ge(this,void 0,void 0,(function(){var t,n,r,o,s,i=this;return Ke(this,(function(a){switch(a.label){case 0:if(t=Date.now(),n=0,r=void 0!==e?e:new Error("Attempting to reconnect due to a unknown error."),null===(o=this.getNextRetryDelay(n++,0,r)))return this.logger.log(be.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),this.completeClose(e),[2];if(this.connectionState=Ye.Reconnecting,e?this.logger.log(be.Information,"Connection reconnecting because of error '"+e+"'."):this.logger.log(be.Information,"Connection reconnecting."),this.onreconnecting){try{this.reconnectingCallbacks.forEach((function(t){return t.apply(i,[e])}))}catch(t){this.logger.log(be.Error,"An onreconnecting callback called with error '"+e+"' threw error '"+t+"'.")}if(this.connectionState!==Ye.Reconnecting)return this.logger.log(be.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting."),[2]}a.label=1;case 1:return null===o?[3,7]:(this.logger.log(be.Information,"Reconnect attempt number "+n+" will start in "+o+" ms."),[4,new Promise((function(e){i.reconnectDelayHandle=setTimeout(e,o)}))]);case 2:if(a.sent(),this.reconnectDelayHandle=void 0,this.connectionState!==Ye.Reconnecting)return this.logger.log(be.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting."),[2];a.label=3;case 3:return a.trys.push([3,5,,6]),[4,this.startInternal()];case 4:if(a.sent(),this.connectionState=Ye.Connected,this.logger.log(be.Information,"HubConnection reconnected successfully."),this.onreconnected)try{this.reconnectedCallbacks.forEach((function(e){return e.apply(i,[i.connection.connectionId])}))}catch(e){this.logger.log(be.Error,"An onreconnected callback called with connectionId '"+this.connection.connectionId+"; threw error '"+e+"'.")}return[2];case 5:return s=a.sent(),this.logger.log(be.Information,"Reconnect attempt failed because of error '"+s+"'."),this.connectionState!==Ye.Reconnecting?(this.logger.log(be.Debug,"Connection left the reconnecting state during reconnect attempt. Done reconnecting."),[2]):(r=s instanceof Error?s:new Error(s.toString()),o=this.getNextRetryDelay(n++,Date.now()-t,r),[3,6]);case 6:return[3,1];case 7:return this.logger.log(be.Information,"Reconnect retries have been exhausted after "+(Date.now()-t)+" ms and "+n+" failed attempts. Connection disconnecting."),this.completeClose(),[2]}}))}))},e.prototype.getNextRetryDelay=function(e,t,n){try{return this.reconnectPolicy.nextRetryDelayInMilliseconds({elapsedMilliseconds:t,previousRetryCount:e,retryReason:n})}catch(n){return this.logger.log(be.Error,"IRetryPolicy.nextRetryDelayInMilliseconds("+e+", "+t+") threw error '"+n+"'."),null}},e.prototype.cancelCallbacksWithError=function(e){var t=this.callbacks;this.callbacks={},Object.keys(t).forEach((function(n){(0,t[n])(null,e)}))},e.prototype.cleanupPingTimer=function(){this.pingServerHandle&&clearTimeout(this.pingServerHandle)},e.prototype.cleanupTimeout=function(){this.timeoutHandle&&clearTimeout(this.timeoutHandle)},e.prototype.createInvocation=function(e,t,n,r){if(n)return{arguments:t,streamIds:r,target:e,type:qe.Invocation};var o=this.invocationId;return this.invocationId++,{arguments:t,invocationId:o.toString(),streamIds:r,target:e,type:qe.Invocation}},e.prototype.launchStreams=function(e,t){var n=this;if(0!==e.length){t||(t=Promise.resolve());var r=function(r){e[r].subscribe({complete:function(){t=t.then((function(){return n.sendWithProtocol(n.createCompletionMessage(r))}))},error:function(e){var o;o=e instanceof Error?e.message:e&&e.toString?e.toString():"Unknown error",t=t.then((function(){return n.sendWithProtocol(n.createCompletionMessage(r,o))}))},next:function(e){t=t.then((function(){return n.sendWithProtocol(n.createStreamItemMessage(r,e))}))}})};for(var o in e)r(o)}},e.prototype.replaceStreamingParams=function(e){for(var t=[],n=[],r=0;r<e.length;r++){var o=e[r];if(this.isObservable(o)){var s=this.invocationId;this.invocationId++,t[s]=o,n.push(s.toString()),e.splice(r,1)}}return[t,n]},e.prototype.isObservable=function(e){return e&&e.subscribe&&"function"==typeof e.subscribe},e.prototype.createStreamInvocation=function(e,t,n){var r=this.invocationId;return this.invocationId++,{arguments:t,invocationId:r.toString(),streamIds:n,target:e,type:qe.StreamInvocation}},e.prototype.createCancelInvocation=function(e){return{invocationId:e,type:qe.CancelInvocation}},e.prototype.createStreamItemMessage=function(e,t){return{invocationId:e,item:t,type:qe.StreamItem}},e.prototype.createCompletionMessage=function(e,t,n){return t?{error:t,invocationId:e,type:qe.Completion}:{invocationId:e,result:n,type:qe.Completion}},e}(),nt=[0,2e3,1e4,3e4,null],rt=function(){function e(e){this.retryDelays=void 0!==e?e.concat([null]):nt}return e.prototype.nextRetryDelayInMilliseconds=function(e){return this.retryDelays[e.previousRetryCount]},e}();!function(e){e[e.None=0]="None",e[e.WebSockets=1]="WebSockets",e[e.ServerSentEvents=2]="ServerSentEvents",e[e.LongPolling=4]="LongPolling"}(Ze||(Ze={})),function(e){e[e.Text=1]="Text",e[e.Binary=2]="Binary"}(et||(et={}));var ot=function(){function e(){this.isAborted=!1,this.onabort=null}return e.prototype.abort=function(){this.isAborted||(this.isAborted=!0,this.onabort&&this.onabort())},Object.defineProperty(e.prototype,"signal",{get:function(){return this},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aborted",{get:function(){return this.isAborted},enumerable:!0,configurable:!0}),e}(),st=function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(i,a)}c((r=r.apply(e,t||[])).next())}))},it=function(e,t){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},at=function(){function e(e,t,n,r){this.httpClient=e,this.accessTokenFactory=t,this.logger=n,this.pollAbort=new ot,this.logMessageContent=r,this.running=!1,this.onreceive=null,this.onclose=null}return Object.defineProperty(e.prototype,"pollAborted",{get:function(){return this.pollAbort.aborted},enumerable:!0,configurable:!0}),e.prototype.connect=function(e,t){return st(this,void 0,void 0,(function(){var n,r,o,s;return it(this,(function(i){switch(i.label){case 0:if(Ne.isRequired(e,"url"),Ne.isRequired(t,"transferFormat"),Ne.isIn(t,et,"transferFormat"),this.url=e,this.logger.log(be.Trace,"(LongPolling transport) Connecting."),t===et.Binary&&"undefined"!=typeof XMLHttpRequest&&"string"!=typeof(new XMLHttpRequest).responseType)throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");return n={abortSignal:this.pollAbort.signal,headers:{},timeout:1e5},t===et.Binary&&(n.responseType="arraybuffer"),[4,this.getAccessToken()];case 1:return r=i.sent(),this.updateHeaderToken(n,r),o=e+"&_="+Date.now(),this.logger.log(be.Trace,"(LongPolling transport) polling: "+o+"."),[4,this.httpClient.get(o,n)];case 2:return 200!==(s=i.sent()).statusCode?(this.logger.log(be.Error,"(LongPolling transport) Unexpected response code: "+s.statusCode+"."),this.closeError=new Se(s.statusText||"",s.statusCode),this.running=!1):this.running=!0,this.receiving=this.poll(this.url,n),[2]}}))}))},e.prototype.getAccessToken=function(){return st(this,void 0,void 0,(function(){return it(this,(function(e){switch(e.label){case 0:return this.accessTokenFactory?[4,this.accessTokenFactory()]:[3,2];case 1:return[2,e.sent()];case 2:return[2,null]}}))}))},e.prototype.updateHeaderToken=function(e,t){e.headers||(e.headers={}),t?e.headers.Authorization="Bearer "+t:e.headers.Authorization&&delete e.headers.Authorization},e.prototype.poll=function(e,t){return st(this,void 0,void 0,(function(){var n,r,o,s;return it(this,(function(i){switch(i.label){case 0:i.trys.push([0,,8,9]),i.label=1;case 1:return this.running?[4,this.getAccessToken()]:[3,7];case 2:n=i.sent(),this.updateHeaderToken(t,n),i.label=3;case 3:return i.trys.push([3,5,,6]),r=e+"&_="+Date.now(),this.logger.log(be.Trace,"(LongPolling transport) polling: "+r+"."),[4,this.httpClient.get(r,t)];case 4:return 204===(o=i.sent()).statusCode?(this.logger.log(be.Information,"(LongPolling transport) Poll terminated by server."),this.running=!1):200!==o.statusCode?(this.logger.log(be.Error,"(LongPolling transport) Unexpected response code: "+o.statusCode+"."),this.closeError=new Se(o.statusText||"",o.statusCode),this.running=!1):o.content?(this.logger.log(be.Trace,"(LongPolling transport) data received. "+De(o.content,this.logMessageContent)+"."),this.onreceive&&this.onreceive(o.content)):this.logger.log(be.Trace,"(LongPolling transport) Poll timed out, reissuing."),[3,6];case 5:return s=i.sent(),this.running?s instanceof Ce?this.logger.log(be.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this.closeError=s,this.running=!1):this.logger.log(be.Trace,"(LongPolling transport) Poll errored after shutdown: "+s.message),[3,6];case 6:return[3,1];case 7:return[3,9];case 8:return this.logger.log(be.Trace,"(LongPolling transport) Polling complete."),this.pollAborted||this.raiseOnClose(),[7];case 9:return[2]}}))}))},e.prototype.send=function(e){return st(this,void 0,void 0,(function(){return it(this,(function(t){return this.running?[2,Ae(this.logger,"LongPolling",this.httpClient,this.url,this.accessTokenFactory,e,this.logMessageContent)]:[2,Promise.reject(new Error("Cannot send until the transport is connected"))]}))}))},e.prototype.stop=function(){return st(this,void 0,void 0,(function(){var e,t;return it(this,(function(n){switch(n.label){case 0:this.logger.log(be.Trace,"(LongPolling transport) Stopping polling."),this.running=!1,this.pollAbort.abort(),n.label=1;case 1:return n.trys.push([1,,5,6]),[4,this.receiving];case 2:return n.sent(),this.logger.log(be.Trace,"(LongPolling transport) sending DELETE request to "+this.url+"."),e={headers:{}},[4,this.getAccessToken()];case 3:return t=n.sent(),this.updateHeaderToken(e,t),[4,this.httpClient.delete(this.url,e)];case 4:return n.sent(),this.logger.log(be.Trace,"(LongPolling transport) DELETE request sent."),[3,6];case 5:return this.logger.log(be.Trace,"(LongPolling transport) Stop finished."),this.raiseOnClose(),[7];case 6:return[2]}}))}))},e.prototype.raiseOnClose=function(){if(this.onclose){var e="(LongPolling transport) Firing onclose event.";this.closeError&&(e+=" Error: "+this.closeError),this.logger.log(be.Trace,e),this.onclose(this.closeError)}},e}(),ct=function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(i,a)}c((r=r.apply(e,t||[])).next())}))},lt=function(e,t){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},ut=function(){function e(e,t,n,r,o){this.httpClient=e,this.accessTokenFactory=t,this.logger=n,this.logMessageContent=r,this.eventSourceConstructor=o,this.onreceive=null,this.onclose=null}return e.prototype.connect=function(e,t){return ct(this,void 0,void 0,(function(){var n,r=this;return lt(this,(function(o){switch(o.label){case 0:return Ne.isRequired(e,"url"),Ne.isRequired(t,"transferFormat"),Ne.isIn(t,et,"transferFormat"),this.logger.log(be.Trace,"(SSE transport) Connecting."),this.url=e,this.accessTokenFactory?[4,this.accessTokenFactory()]:[3,2];case 1:(n=o.sent())&&(e+=(e.indexOf("?")<0?"?":"&")+"access_token="+encodeURIComponent(n)),o.label=2;case 2:return[2,new Promise((function(n,o){var s=!1;if(t===et.Text){var i;if(Re.isBrowser||Re.isWebWorker)i=new r.eventSourceConstructor(e,{withCredentials:!0});else{var a=r.httpClient.getCookieString(e);i=new r.eventSourceConstructor(e,{withCredentials:!0,headers:{Cookie:a}})}try{i.onmessage=function(e){if(r.onreceive)try{r.logger.log(be.Trace,"(SSE transport) data received. "+De(e.data,r.logMessageContent)+"."),r.onreceive(e.data)}catch(e){return void r.close(e)}},i.onerror=function(e){var t=new Error(e.data||"Error occurred");s?r.close(t):o(t)},i.onopen=function(){r.logger.log(be.Information,"SSE connected to "+r.url),r.eventSource=i,s=!0,n()}}catch(e){return void o(e)}}else o(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"))}))]}}))}))},e.prototype.send=function(e){return ct(this,void 0,void 0,(function(){return lt(this,(function(t){return this.eventSource?[2,Ae(this.logger,"SSE",this.httpClient,this.url,this.accessTokenFactory,e,this.logMessageContent)]:[2,Promise.reject(new Error("Cannot send until the transport is connected"))]}))}))},e.prototype.stop=function(){return this.close(),Promise.resolve()},e.prototype.close=function(e){this.eventSource&&(this.eventSource.close(),this.eventSource=void 0,this.onclose&&this.onclose(e))},e}(),ht=function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(i,a)}c((r=r.apply(e,t||[])).next())}))},pt=function(e,t){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},dt=function(){function e(e,t,n,r,o){this.logger=n,this.accessTokenFactory=t,this.logMessageContent=r,this.webSocketConstructor=o,this.httpClient=e,this.onreceive=null,this.onclose=null}return e.prototype.connect=function(e,t){return ht(this,void 0,void 0,(function(){var n,r=this;return pt(this,(function(o){switch(o.label){case 0:return Ne.isRequired(e,"url"),Ne.isRequired(t,"transferFormat"),Ne.isIn(t,et,"transferFormat"),this.logger.log(be.Trace,"(WebSockets transport) Connecting."),this.accessTokenFactory?[4,this.accessTokenFactory()]:[3,2];case 1:(n=o.sent())&&(e+=(e.indexOf("?")<0?"?":"&")+"access_token="+encodeURIComponent(n)),o.label=2;case 2:return[2,new Promise((function(n,o){var s;e=e.replace(/^http/,"ws");var i=r.httpClient.getCookieString(e),a=!1;Re.isNode&&i&&(s=new r.webSocketConstructor(e,void 0,{headers:{Cookie:""+i}})),s||(s=new r.webSocketConstructor(e)),t===et.Binary&&(s.binaryType="arraybuffer"),s.onopen=function(t){r.logger.log(be.Information,"WebSocket connected to "+e+"."),r.webSocket=s,a=!0,n()},s.onerror=function(e){var t=null;t="undefined"!=typeof ErrorEvent&&e instanceof ErrorEvent?e.error:new Error("There was an error with the transport."),o(t)},s.onmessage=function(e){r.logger.log(be.Trace,"(WebSockets transport) data received. "+De(e.data,r.logMessageContent)+"."),r.onreceive&&r.onreceive(e.data)},s.onclose=function(e){if(a)r.close(e);else{var t=null;t="undefined"!=typeof ErrorEvent&&e instanceof ErrorEvent?e.error:new Error("There was an error with the transport."),o(t)}}}))]}}))}))},e.prototype.send=function(e){return this.webSocket&&this.webSocket.readyState===this.webSocketConstructor.OPEN?(this.logger.log(be.Trace,"(WebSockets transport) sending data. "+De(e,this.logMessageContent)+"."),this.webSocket.send(e),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")},e.prototype.stop=function(){return this.webSocket&&this.close(void 0),Promise.resolve()},e.prototype.close=function(e){this.webSocket&&(this.webSocket.onclose=function(){},this.webSocket.onmessage=function(){},this.webSocket.onerror=function(){},this.webSocket.close(),this.webSocket=void 0),this.logger.log(be.Trace,"(WebSockets transport) socket closed."),this.onclose&&(!e||!1!==e.wasClean&&1e3===e.code?this.onclose():this.onclose(new Error("WebSocket closed with status code: "+e.code+" ("+e.reason+").")))},e}(),gt=function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(i,a)}c((r=r.apply(e,t||[])).next())}))},ft=function(e,t){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},mt=null,yt=null;if(Re.isNode&&"undefined"!=typeof require){var vt="function"==typeof __webpack_require__?__non_webpack_require__:require;mt=vt("ws"),yt=vt("eventsource")}var bt=function(){function e(e,t){var n;void 0===t&&(t={}),this.features={},this.negotiateVersion=1,Ne.isRequired(e,"url"),this.logger=void 0===(n=t.logger)?new He(be.Information):null===n?Te.instance:n.log?n:new He(n),this.baseUrl=this.resolveUrl(e),(t=t||{}).logMessageContent=t.logMessageContent||!1,Re.isNode||"undefined"==typeof WebSocket||t.WebSocket?Re.isNode&&!t.WebSocket&&mt&&(t.WebSocket=mt):t.WebSocket=WebSocket,Re.isNode||"undefined"==typeof EventSource||t.EventSource?Re.isNode&&!t.EventSource&&void 0!==yt&&(t.EventSource=yt):t.EventSource=EventSource,this.httpClient=t.httpClient||new $e(this.logger),this.connectionState="Disconnected",this.connectionStarted=!1,this.options=t,this.onreceive=null,this.onclose=null}return e.prototype.start=function(e){return gt(this,void 0,void 0,(function(){var t;return ft(this,(function(n){switch(n.label){case 0:return e=e||et.Binary,Ne.isIn(e,et,"transferFormat"),this.logger.log(be.Debug,"Starting connection with transfer format '"+et[e]+"'."),"Disconnected"!==this.connectionState?[2,Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."))]:(this.connectionState="Connecting ",this.startInternalPromise=this.startInternal(e),[4,this.startInternalPromise]);case 1:return n.sent(),"Disconnecting"!==this.connectionState?[3,3]:(t="Failed to start the HttpConnection before stop() was called.",this.logger.log(be.Error,t),[4,this.stopPromise]);case 2:return n.sent(),[2,Promise.reject(new Error(t))];case 3:if("Connected"!==this.connectionState)return t="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!",this.logger.log(be.Error,t),[2,Promise.reject(new Error(t))];n.label=4;case 4:return this.connectionStarted=!0,[2]}}))}))},e.prototype.send=function(e){return"Connected"!==this.connectionState?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this.sendQueue||(this.sendQueue=new wt(this.transport)),this.sendQueue.send(e))},e.prototype.stop=function(e){return gt(this,void 0,void 0,(function(){var t=this;return ft(this,(function(n){switch(n.label){case 0:return"Disconnected"===this.connectionState?(this.logger.log(be.Debug,"Call to HttpConnection.stop("+e+") ignored because the connection is already in the disconnected state."),[2,Promise.resolve()]):"Disconnecting"===this.connectionState?(this.logger.log(be.Debug,"Call to HttpConnection.stop("+e+") ignored because the connection is already in the disconnecting state."),[2,this.stopPromise]):(this.connectionState="Disconnecting",this.stopPromise=new Promise((function(e){t.stopPromiseResolver=e})),[4,this.stopInternal(e)]);case 1:return n.sent(),[4,this.stopPromise];case 2:return n.sent(),[2]}}))}))},e.prototype.stopInternal=function(e){return gt(this,void 0,void 0,(function(){var t;return ft(this,(function(n){switch(n.label){case 0:this.stopError=e,n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.startInternalPromise];case 2:return n.sent(),[3,4];case 3:return n.sent(),[3,4];case 4:if(!this.transport)return[3,9];n.label=5;case 5:return n.trys.push([5,7,,8]),[4,this.transport.stop()];case 6:return n.sent(),[3,8];case 7:return t=n.sent(),this.logger.log(be.Error,"HttpConnection.transport.stop() threw error '"+t+"'."),this.stopConnection(),[3,8];case 8:return this.transport=void 0,[3,10];case 9:this.logger.log(be.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed."),this.stopConnection(),n.label=10;case 10:return[2]}}))}))},e.prototype.startInternal=function(e){return gt(this,void 0,void 0,(function(){var t,n,r,o,s,i;return ft(this,(function(a){switch(a.label){case 0:t=this.baseUrl,this.accessTokenFactory=this.options.accessTokenFactory,a.label=1;case 1:return a.trys.push([1,12,,13]),this.options.skipNegotiation?this.options.transport!==Ze.WebSockets?[3,3]:(this.transport=this.constructTransport(Ze.WebSockets),[4,this.startTransport(t,e)]):[3,5];case 2:return a.sent(),[3,4];case 3:throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");case 4:return[3,11];case 5:n=null,r=0,o=function(){var e;return ft(this,(function(o){switch(o.label){case 0:return[4,s.getNegotiationResponse(t)];case 1:if(n=o.sent(),"Disconnecting"===s.connectionState||"Disconnected"===s.connectionState)throw new Error("The connection was stopped during negotiation.");if(n.error)throw new Error(n.error);if(n.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");return n.url&&(t=n.url),n.accessToken&&(e=n.accessToken,s.accessTokenFactory=function(){return e}),r++,[2]}}))},s=this,a.label=6;case 6:return[5,o()];case 7:a.sent(),a.label=8;case 8:if(n.url&&r<100)return[3,6];a.label=9;case 9:if(100===r&&n.url)throw new Error("Negotiate redirection limit exceeded.");return[4,this.createTransport(t,this.options.transport,n,e)];case 10:a.sent(),a.label=11;case 11:return this.transport instanceof at&&(this.features.inherentKeepAlive=!0),"Connecting "===this.connectionState&&(this.logger.log(be.Debug,"The HttpConnection connected successfully."),this.connectionState="Connected"),[3,13];case 12:return i=a.sent(),this.logger.log(be.Error,"Failed to start the connection: "+i),this.connectionState="Disconnected",this.transport=void 0,[2,Promise.reject(i)];case 13:return[2]}}))}))},e.prototype.getNegotiationResponse=function(e){return gt(this,void 0,void 0,(function(){var t,n,r,o,s,i,a;return ft(this,(function(c){switch(c.label){case 0:return this.accessTokenFactory?[4,this.accessTokenFactory()]:[3,2];case 1:(r=c.sent())&&((t={}).Authorization="Bearer "+r,n=t),c.label=2;case 2:o=this.resolveNegotiateUrl(e),this.logger.log(be.Debug,"Sending negotiation request: "+o+"."),c.label=3;case 3:return c.trys.push([3,5,,6]),[4,this.httpClient.post(o,{content:"",headers:n})];case 4:return 200!==(s=c.sent()).statusCode?[2,Promise.reject(new Error("Unexpected status code returned from negotiate "+s.statusCode))]:((!(i=JSON.parse(s.content)).negotiateVersion||i.negotiateVersion<1)&&(i.connectionToken=i.connectionId),[2,i]);case 5:return a=c.sent(),this.logger.log(be.Error,"Failed to complete negotiation with the server: "+a),[2,Promise.reject(a)];case 6:return[2]}}))}))},e.prototype.createConnectUrl=function(e,t){return t?e+(-1===e.indexOf("?")?"?":"&")+"id="+t:e},e.prototype.createTransport=function(e,t,n,r){return gt(this,void 0,void 0,(function(){var o,s,i,a,c,l,u,h,p,d,g;return ft(this,(function(f){switch(f.label){case 0:return o=this.createConnectUrl(e,n.connectionToken),this.isITransport(t)?(this.logger.log(be.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=t,[4,this.startTransport(o,r)]):[3,2];case 1:return f.sent(),this.connectionId=n.connectionId,[2];case 2:s=[],i=n.availableTransports||[],a=n,c=0,l=i,f.label=3;case 3:return c<l.length?(u=l[c],(h=this.resolveTransportOrError(u,t,r))instanceof Error?(s.push(u.transport+" failed: "+h),[3,12]):[3,4]):[3,13];case 4:if(!this.isITransport(h))return[3,12];if(this.transport=h,a)return[3,9];f.label=5;case 5:return f.trys.push([5,7,,8]),[4,this.getNegotiationResponse(e)];case 6:return a=f.sent(),[3,8];case 7:return p=f.sent(),[2,Promise.reject(p)];case 8:o=this.createConnectUrl(e,a.connectionToken),f.label=9;case 9:return f.trys.push([9,11,,12]),[4,this.startTransport(o,r)];case 10:return f.sent(),this.connectionId=a.connectionId,[2];case 11:return d=f.sent(),this.logger.log(be.Error,"Failed to start the transport '"+u.transport+"': "+d),a=void 0,s.push(u.transport+" failed: "+d),"Connecting "!==this.connectionState?(g="Failed to select transport before stop() was called.",this.logger.log(be.Debug,g),[2,Promise.reject(new Error(g))]):[3,12];case 12:return c++,[3,3];case 13:return s.length>0?[2,Promise.reject(new Error("Unable to connect to the server with any of the available transports. "+s.join(" ")))]:[2,Promise.reject(new Error("None of the transports supported by the client are supported by the server."))]}}))}))},e.prototype.constructTransport=function(e){switch(e){case Ze.WebSockets:if(!this.options.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new dt(this.httpClient,this.accessTokenFactory,this.logger,this.options.logMessageContent||!1,this.options.WebSocket);case Ze.ServerSentEvents:if(!this.options.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new ut(this.httpClient,this.accessTokenFactory,this.logger,this.options.logMessageContent||!1,this.options.EventSource);case Ze.LongPolling:return new at(this.httpClient,this.accessTokenFactory,this.logger,this.options.logMessageContent||!1);default:throw new Error("Unknown transport: "+e+".")}},e.prototype.startTransport=function(e,t){var n=this;return this.transport.onreceive=this.onreceive,this.transport.onclose=function(e){return n.stopConnection(e)},this.transport.connect(e,t)},e.prototype.resolveTransportOrError=function(e,t,n){var r=Ze[e.transport];if(null==r)return this.logger.log(be.Debug,"Skipping transport '"+e.transport+"' because it is not supported by this client."),new Error("Skipping transport '"+e.transport+"' because it is not supported by this client.");if(!function(e,t){return!e||0!=(t&e)}(t,r))return this.logger.log(be.Debug,"Skipping transport '"+Ze[r]+"' because it was disabled by the client."),new Error("'"+Ze[r]+"' is disabled by the client.");if(!(e.transferFormats.map((function(e){return et[e]})).indexOf(n)>=0))return this.logger.log(be.Debug,"Skipping transport '"+Ze[r]+"' because it does not support the requested transfer format '"+et[n]+"'."),new Error("'"+Ze[r]+"' does not support "+et[n]+".");if(r===Ze.WebSockets&&!this.options.WebSocket||r===Ze.ServerSentEvents&&!this.options.EventSource)return this.logger.log(be.Debug,"Skipping transport '"+Ze[r]+"' because it is not supported in your environment.'"),new Error("'"+Ze[r]+"' is not supported in your environment.");this.logger.log(be.Debug,"Selecting transport '"+Ze[r]+"'.");try{return this.constructTransport(r)}catch(e){return e}},e.prototype.isITransport=function(e){return e&&"object"==typeof e&&"connect"in e},e.prototype.stopConnection=function(e){var t=this;if(this.logger.log(be.Debug,"HttpConnection.stopConnection("+e+") called while in state "+this.connectionState+"."),this.transport=void 0,e=this.stopError||e,this.stopError=void 0,"Disconnected"!==this.connectionState)if("Connecting "!==this.connectionState){if("Disconnecting"===this.connectionState&&this.stopPromiseResolver(),e?this.logger.log(be.Error,"Connection disconnected with error '"+e+"'."):this.logger.log(be.Information,"Connection disconnected."),this.sendQueue&&(this.sendQueue.stop().catch((function(e){t.logger.log(be.Error,"TransportSendQueue.stop() threw error '"+e+"'.")})),this.sendQueue=void 0),this.connectionId=void 0,this.connectionState="Disconnected",this.connectionStarted){this.connectionStarted=!1;try{this.onclose&&this.onclose(e)}catch(t){this.logger.log(be.Error,"HttpConnection.onclose("+e+") threw error '"+t+"'.")}}}else this.logger.log(be.Warning,"Call to HttpConnection.stopConnection("+e+") was ignored because the connection hasn't yet left the in the connecting state.");else this.logger.log(be.Debug,"Call to HttpConnection.stopConnection("+e+") was ignored because the connection is already in the disconnected state.")},e.prototype.resolveUrl=function(e){if(0===e.lastIndexOf("https://",0)||0===e.lastIndexOf("http://",0))return e;if(!Re.isBrowser||!window.document)throw new Error("Cannot resolve '"+e+"'.");var t=window.document.createElement("a");return t.href=e,this.logger.log(be.Information,"Normalizing '"+e+"' to '"+t.href+"'."),t.href},e.prototype.resolveNegotiateUrl=function(e){var t=e.indexOf("?"),n=e.substring(0,-1===t?e.length:t);return"/"!==n[n.length-1]&&(n+="/"),n+="negotiate",-1===(n+=-1===t?"":e.substring(t)).indexOf("negotiateVersion")&&(n+=-1===t?"?":"&",n+="negotiateVersion="+this.negotiateVersion),n},e}();var wt=function(){function e(e){this.transport=e,this.buffer=[],this.executing=!0,this.sendBufferedData=new St,this.transportResult=new St,this.sendLoopPromise=this.sendLoop()}return e.prototype.send=function(e){return this.bufferData(e),this.transportResult||(this.transportResult=new St),this.transportResult.promise},e.prototype.stop=function(){return this.executing=!1,this.sendBufferedData.resolve(),this.sendLoopPromise},e.prototype.bufferData=function(e){if(this.buffer.length&&typeof this.buffer[0]!=typeof e)throw new Error("Expected data to be of type "+typeof this.buffer+" but was of type "+typeof e);this.buffer.push(e),this.sendBufferedData.resolve()},e.prototype.sendLoop=function(){return gt(this,void 0,void 0,(function(){var t,n,r;return ft(this,(function(o){switch(o.label){case 0:return[4,this.sendBufferedData.promise];case 1:if(o.sent(),!this.executing)return this.transportResult&&this.transportResult.reject("Connection stopped."),[3,6];this.sendBufferedData=new St,t=this.transportResult,this.transportResult=void 0,n="string"==typeof this.buffer[0]?this.buffer.join(""):e.concatBuffers(this.buffer),this.buffer.length=0,o.label=2;case 2:return o.trys.push([2,4,,5]),[4,this.transport.send(n)];case 3:return o.sent(),t.resolve(),[3,5];case 4:return r=o.sent(),t.reject(r),[3,5];case 5:return[3,0];case 6:return[2]}}))}))},e.concatBuffers=function(e){for(var t=e.map((function(e){return e.byteLength})).reduce((function(e,t){return e+t})),n=new Uint8Array(t),r=0,o=0,s=e;o<s.length;o++){var i=s[o];n.set(new Uint8Array(i),r),r+=i.byteLength}return n},e}(),St=function(){function e(){var e=this;this.promise=new Promise((function(t,n){var r;return r=[t,n],e.resolver=r[0],e.rejecter=r[1],r}))}return e.prototype.resolve=function(){this.resolver()},e.prototype.reject=function(e){this.rejecter(e)},e}(),Ct=function(){function e(){this.name="json",this.version=1,this.transferFormat=et.Text}return e.prototype.parseMessages=function(e,t){if("string"!=typeof e)throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!e)return[];null===t&&(t=Te.instance);for(var n=[],r=0,o=ze.parse(e);r<o.length;r++){var s=o[r],i=JSON.parse(s);if("number"!=typeof i.type)throw new Error("Invalid payload.");switch(i.type){case qe.Invocation:this.isInvocationMessage(i);break;case qe.StreamItem:this.isStreamItemMessage(i);break;case qe.Completion:this.isCompletionMessage(i);break;case qe.Ping:case qe.Close:break;default:t.log(be.Information,"Unknown message type '"+i.type+"' ignored.");continue}n.push(i)}return n},e.prototype.writeMessage=function(e){return ze.write(JSON.stringify(e))},e.prototype.isInvocationMessage=function(e){this.assertNotEmptyString(e.target,"Invalid payload for Invocation message."),void 0!==e.invocationId&&this.assertNotEmptyString(e.invocationId,"Invalid payload for Invocation message.")},e.prototype.isStreamItemMessage=function(e){if(this.assertNotEmptyString(e.invocationId,"Invalid payload for StreamItem message."),void 0===e.item)throw new Error("Invalid payload for StreamItem message.")},e.prototype.isCompletionMessage=function(e){if(e.result&&e.error)throw new Error("Invalid payload for Completion message.");!e.result&&e.error&&this.assertNotEmptyString(e.error,"Invalid payload for Completion message."),this.assertNotEmptyString(e.invocationId,"Invalid payload for Completion message.")},e.prototype.assertNotEmptyString=function(e,t){if("string"!=typeof e||""===e)throw new Error(t)},e}(),kt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},_t={trace:be.Trace,debug:be.Debug,info:be.Information,information:be.Information,warn:be.Warning,warning:be.Warning,error:be.Error,critical:be.Critical,none:be.None};var Pt=function(){function e(){}return e.prototype.configureLogging=function(e){if(Ne.isRequired(e,"logging"),void 0!==e.log)this.logger=e;else if("string"==typeof e){var t=function(e){var t=_t[e.toLowerCase()];if(void 0!==t)return t;throw new Error("Unknown log level: "+e)}(e);this.logger=new He(t)}else this.logger=new He(e);return this},e.prototype.withUrl=function(e,t){return Ne.isRequired(e,"url"),this.url=e,this.httpConnectionOptions=kt({},this.httpConnectionOptions,"object"==typeof t?t:{transport:t}),this},e.prototype.withHubProtocol=function(e){return Ne.isRequired(e,"protocol"),this.protocol=e,this},e.prototype.withAutomaticReconnect=function(e){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return e?Array.isArray(e)?this.reconnectPolicy=new rt(e):this.reconnectPolicy=e:this.reconnectPolicy=new rt,this},e.prototype.build=function(){var e=this.httpConnectionOptions||{};if(void 0===e.logger&&(e.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");var t=new bt(this.url,e);return tt.create(t,this.logger||Te.instance,this.protocol||new Ct,this.reconnectPolicy)},e}();let Et,Tt,xt,It,Nt=e=>e;class Rt extends re{constructor(){super(...arguments),this.messages=[],this.maxMessages=7,this.messageTimeout=2e4,this.webServiceUrl="",this.messageList=e=>L(Et||(Et=Nt` ${0} `),ye(e,(e=>e.messageId),((e,t)=>L(Tt||(Tt=Nt` <twitch-chat-message .message="${0}" timeout="${0}"> `),e,this.messageTimeout))))}connectedCallback(){super.connectedCallback();const e=(new Pt).withUrl(this.webServiceUrl).configureLogging(be.Information).withAutomaticReconnect().build();e.on("ReceiveChatMessage",((e,t)=>{var n;const r=this.messages.filter((e=>!(!0===e.expired))).slice(Math.max(this.messages.length-this.maxMessages,0));var o={...e,userTypeList:null===(n=e.userTypes)||void 0===n?void 0:n.split(",").map((e=>e.trim().toLocaleLowerCase()))};this.setAttribute("messages",JSON.stringify([...r,o]))})),e.start().then((()=>{console.log("Connected")})).catch((e=>console.error(e.toString())))}render(){return L(xt||(xt=Nt` <div class="messageQueue"> ${0} </div> `),this.messageList(this.messages))}}Rt.styles=te(It||(It=Nt`.messageQueue{display:flex;flex-direction:column;position:fixed;left:0;bottom:0;width:400px}`)),e([Q({type:Array})],Rt.prototype,"messages",void 0),e([Q({type:Number})],Rt.prototype,"maxMessages",void 0),e([Q({type:Number})],Rt.prototype,"messageTimeout",void 0),e([Q({type:String})],Rt.prototype,"webServiceUrl",void 0),customElements.define("twitch-messages",Rt),customElements.define("twitch-chat-message",le);
